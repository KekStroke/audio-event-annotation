# Контекст Проекта: Audio Event Annotation Tool

**Последнее обновление**: 2025-11-10

## 1. Описание Проекта

Веб-приложение для ручной аннотации больших аудио-файлов (до нескольких ГБ) из локальной файловой системы. Инструмент позволяет визуализировать аудио через waveform и спектрограмму, выделять временные интервалы, прослушивать фрагменты и размечать наличие интересующих событий для создания датасетов.

## 2. Ключевые Сущности (Entities)

- **AudioFile**:
  - `id`: UUID
  - `file_path`: String (абсолютный путь к файлу в ФС)
  - `filename`: String
  - `duration`: Float (секунды)
  - `sample_rate`: Integer (Hz)
  - `channels`: Integer
  - `file_size`: Integer (bytes)
  - `created_at`: DateTime
  - `status`: Enum (pending, loaded, error)

- **Annotation**:
  - `id`: UUID
  - `audio_file_id`: UUID (FK to AudioFile)
  - `start_time`: Float (секунды)
  - `end_time`: Float (секунды)
  - `event_label`: String
  - `confidence`: Float (0-1, опциональная оценка уверенности)
  - `notes`: Text (опциональные заметки)
  - `created_at`: DateTime
  - `updated_at`: DateTime

- **EventType**:
  - `id`: UUID
  - `name`: String (название типа события)
  - `color`: String (hex-код для UI)
  - `description`: Text

- **Project**:
  - `id`: UUID
  - `name`: String
  - `description`: Text
  - `created_at`: DateTime

## 3. Технологический Стек

- **Backend**: Python 3.11+ с Flask (легковесный, подходит для MVP)
- **Аудио-обработка**: librosa, scipy, numpy, soundfile
- **Database**: SQLite (простота развертывания, достаточно для MVP)
- **ORM**: SQLAlchemy
- **Frontend**: Vanilla HTML5/CSS3/JavaScript (без NPM-зависимостей)
- **Аудио UI**: wavesurfer.js (CDN) для визуализации и воспроизведения
- **Testing**: pytest, pytest-bdd (BDD-подход)
- **API**: RESTful JSON API

## 4. Архитектурные Решения (Decision Log)

- **2025-11-10**: Принято решение использовать Flask для MVP из-за простоты и быстроты разработки. Монолитная архитектура.

- **2025-11-10**: Для работы с большими файлами (несколько ГБ) будет использоваться потоковая загрузка и обработка чанками. Файлы не загружаются целиком в память.

- **2025-11-10**: Визуализация waveform и спектрограммы будет генерироваться на бэкенде с кэшированием изображений для ускорения повторной загрузки.

- **2025-11-10**: Файлы остаются в локальной ФС пользователя. Приложение работает как локальный сервер с доступом к файловой системе.

- **2025-11-10**: Отказ от NPM-зависимостей на фронтенде. Все JS-библиотеки подключаются через CDN или включаются в репозиторий.

- **2025-11-10**: Разработка ведется по BDD-методологии. Тесты пишутся до кода.

- **2025-11-10**: Максимальный размер файлов проекта — 400 строк. При превышении требуется рефакторинг.

- **2025-11-10**: Аннотации сохраняются в БД и экспортируются в стандартные форматы (JSON, CSV, Audacity labels).

## 5. MVP Scope (Минимально Жизнеспособный Продукт)

### Обязательные функции:
1. Выбор аудио-файла из локальной ФС
2. Отображение waveform всего файла
3. Отображение спектрограммы для выбранного участка
4. Выделение временного интервала мышью
5. Воспроизведение выделенного участка
6. Создание аннотации с меткой события
7. Список всех аннотаций для файла
8. Сохранение аннотаций в БД
9. Экспорт аннотаций в JSON

### Отложенные функции (Post-MVP):
- Горячие клавиши для быстрой разметки
- Поддержка множественных проектов
- Статистика по разметке
- Импорт существующих аннотаций
- Коллаборативная разметка
- Автоматические предложения на основе ML-моделей

