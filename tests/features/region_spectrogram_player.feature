Feature: Интерактивная спектрограмма для выделенного региона
  Как пользователь приложения
  Я хочу видеть интерактивную спектрограмму выделенного региона
  Чтобы детально анализировать частотный спектр и воспроизводить region отдельно

  Background:
    Given браузер открыт на странице приложения
    And в системе загружен аудио файл

  Scenario: Отображение спектрограммы при выделении региона
    When пользователь выделяет регион на основной waveform
    Then появляется отдельная waveform ниже основной
    And отдельная waveform содержит только аудио выделенного интервала
    And под отдельной waveform отображается спектрограмма
    And спектрограмма визуализирует частотный спектр региона

  Scenario: Controls для воспроизведения региона
    Given пользователь выделил регион на waveform
    And отображается отдельная waveform региона со спектрограммой
    When пользователь нажимает play на region player
    Then воспроизводится только аудио выделенного региона
    And прогресс отображается на region waveform
    And спектрограмма синхронизирована с воспроизведением

  Scenario: Независимое управление region player
    Given отображается region player со спектрограммой
    When пользователь управляет region player
    Then основной player не изменяет своё состояние
    And можно воспроизводить region независимо от основного аудио

  Scenario: Обновление спектрограммы при изменении региона
    Given отображается region player со спектрограммой
    When пользователь изменяет границы региона
    Then region waveform обновляется с новым интервалом
    And спектрограмма перерисовывается для нового интервала
    And длительность region player соответствует новому интервалу

  Scenario: Скрытие спектрограммы при очистке региона
    Given отображается region player со спектрограммой
    When пользователь очищает выделение региона
    Then region player скрывается
    And спектрограмма удаляется
    And основная waveform остаётся без изменений

  Scenario: Настройки спектрограммы
    Given отображается спектрограмма региона
    Then спектрограмма использует colorMap по умолчанию
    And спектрограмма отображает frequency labels
    And высота спектрограммы задана в настройках
    And используется mel или linear scale для частот

  Scenario: Воспроизведение через region player
    Given отображается region player со спектрограммой
    When пользователь кликает на region waveform
    Then воспроизведение начинается с выбранной позиции
    And курсор перемещается по region waveform
    And спектрограмма не изменяется при воспроизведении

  Scenario: Пауза и остановка region player
    Given region player воспроизводит аудио
    When пользователь нажимает pause
    Then воспроизведение region приостанавливается
    And позиция курсора сохраняется
    And при повторном play воспроизведение продолжается
