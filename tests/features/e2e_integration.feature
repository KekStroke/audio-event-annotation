Feature: E2E интеграционное тестирование
  Как пользователь приложения
  Я хочу использовать все функции приложения в полном цикле
  Чтобы убедиться что все компоненты работают вместе

  Background:
    Given Flask приложение запущено
    And база данных инициализирована

  Scenario: Полный цикл работы с аннотациями
    Given в БД существует AudioFile с id
    And в БД существует EventType с именем "speech"
    When я загружаю аудио файл через API
    Then файл должен быть добавлен в БД
    When я получаю список аннотаций для файла
    Then список должен быть пустым
    When я создаю аннотацию через API
    Then аннотация должна быть создана в БД
    When я получаю список аннотаций для файла
    Then список должен содержать одну аннотацию
    When я обновляю аннотацию через API
    Then аннотация должна быть обновлена в БД
    When я экспортирую аннотации в JSON
    Then JSON должен содержать метаданные файла и аннотации
    When я удаляю аннотацию через API
    Then аннотация должна быть удалена из БД
    When я получаю список аннотаций для файла
    Then список должен быть пустым

  Scenario: Загрузка файла и визуализация
    Given в БД существует AudioFile с id
    When я получаю метаданные аудио файла через API
    Then ответ должен содержать метаданные файла
    When я запрашиваю waveform для файла
    Then ответ должен быть PNG изображением
    When я запрашиваю спектрограмму для файла
    Then ответ должен быть PNG изображением

  Scenario: Работа с регионами и аннотациями
    Given в БД существует AudioFile с id
    And в БД существует EventType с именем "speech"
    And в БД существует Annotation для AudioFile
    When я получаю список аннотаций для файла
    Then список должен содержать аннотацию
    When я получаю одну аннотацию по ID
    Then ответ должен содержать данные аннотации
    When я создаю вторую аннотацию через API
    Then в БД должно быть две аннотации для файла

